{"version":3,"sources":["./src/app/common/service/campaign/campaign.service.ts"],"names":[],"mappings":"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","file":"common.js","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { AngularFirestore } from '@angular/fire/firestore';\r\nimport { Campaign } from '../../dto/campaign';\r\nimport { UserService } from '../user/user.service';\r\nimport firebase from 'firebase';\r\nimport { StringKeyVal } from '../../interface/string-key-val';\r\nimport { SubscriptionService } from '../subcription/subscription.service';\r\nimport { TrackingType } from '../../enums/tracking-type.enum';\r\n\r\n@Injectable({\r\n\tprovidedIn: 'root'\r\n})\r\nexport class CampaignService {\r\n\t\r\n\tprivate campaignList: Campaign[];\r\n\tprivate dataset: StringKeyVal[];\r\n\r\n\tconstructor(private fireStore: AngularFirestore, private userService: UserService,\r\n\t\tprivate subcriptionService: SubscriptionService) {\r\n\t\tthis.campaignList = [];\r\n\t\tthis.dataset = [];\r\n\t}\r\n\r\n\tcreate(campaign: Campaign): Promise<Campaign> {\r\n\r\n\t\treturn new Promise<Campaign>(async (result, reject) => {\r\n\r\n\t\t\tconst uid: string | null = await this.userService.getActiveUserId();\r\n\r\n\t\t\tif (uid == null) {\r\n\t\t\t\treturn reject({\r\n\t\t\t\t\tmessage: \"User session is not valid. Please Login and try again.\"\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tcampaign.uid = uid;\r\n\t\t\t\tcampaign.created = new Date().getTime();\r\n\t\t\t}\r\n\r\n\t\t\tthis.fireStore.collection(\"campaign\").add(campaign).then(\r\n\t\t\t\t(value: firebase.firestore.DocumentReference<unknown>) => {\r\n\t\t\t\t\tthis.subcriptionService.track(uid, TrackingType.CAMPAIGN, 1);\r\n\t\t\t\t\tcampaign.id = value.id;\r\n\t\t\t\t\tif (this.campaignList.length == 0) {\r\n\t\t\t\t\t\tthis.loadAllCampaign();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst data: StringKeyVal = {\r\n\t\t\t\t\t\t\tkey: campaign.id,\r\n\t\t\t\t\t\t\tvalue: campaign.name\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.campaignList.splice(0, 0, campaign);\r\n\t\t\t\t\t\tthis.dataset.splice(0, 0, data);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn result(campaign);\r\n\t\t\t\t},\r\n\t\t\t\t(reason: any) => {\r\n\t\t\t\t\treturn reject(reason);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t});\r\n\t}\r\n\r\n\tgetAllCampaign(): Campaign[] {\r\n\t\tif (this.campaignList.length == 0) {\r\n\t\t\tthis.loadAllCampaign();\r\n\t\t}\r\n\t\treturn this.campaignList;\r\n\t}\r\n\r\n\tgetDataset(): StringKeyVal[] {\r\n\t\tif (this.dataset.length == 0) {\r\n\t\t\tthis.loadAllCampaign();\r\n\t\t}\r\n\t\treturn this.dataset;\r\n\t}\r\n\r\n\tprivate async loadAllCampaign(): Promise<boolean> {\r\n\r\n\t\tconst uid: string | null = await this.userService.getActiveUserId();\r\n\r\n\r\n\t\tif (uid == null) {\r\n\t\t\treturn Promise.reject({\r\n\t\t\t\tmessage: \"User session is not valid. Please Login and try again.\"\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.fireStore.collection(\"campaign\", ref => ref.where(\"uid\", \"==\", uid)\r\n\t\t\t.orderBy(\"created\", \"desc\"))\r\n\t\t\t.get()\r\n\t\t\t.subscribe({\r\n\t\t\t\tnext: (result: firebase.firestore.QuerySnapshot<unknown>) => {\r\n\t\t\t\t\tthis.campaignList.splice(0);\r\n\t\t\t\t\tresult.forEach((snapshot: firebase.firestore.QueryDocumentSnapshot<unknown>) => {\r\n\t\t\t\t\t\tconst campaign: Campaign = snapshot.data() as Campaign;\r\n\t\t\t\t\t\tcampaign.id = snapshot.id;\r\n\r\n\t\t\t\t\t\tconst data: StringKeyVal = {\r\n\t\t\t\t\t\t\tkey: campaign.id,\r\n\t\t\t\t\t\t\tvalue: campaign.name\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.campaignList.push(campaign);\r\n\t\t\t\t\t\tthis.dataset.push(data);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn Promise.resolve(true);\r\n\t}\r\n\r\n\tremove(campaignId: string): Promise<boolean> {\r\n\t\treturn new Promise<boolean>(async (resolve) => {\r\n\t\t\tconst uid: string | null = await this.userService.getActiveUserId();\r\n\r\n\r\n\t\t\tif (uid == null) {\r\n\t\t\t\treturn Promise.reject({\r\n\t\t\t\t\tmessage: \"User session is not valid. Please Login and try again.\"\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\r\n\t\t\tthis.fireStore.collection(\"campaign\").doc(campaignId).delete().then(\r\n\t\t\t\t() => {\r\n\t\t\t\t\tthis.subcriptionService.track(uid, TrackingType.CAMPAIGN, -1);\r\n\t\t\t\t\tconst index: number = this.campaignList.findIndex((campaign: Campaign) => {\r\n\t\t\t\t\t\treturn campaignId === campaign.id;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif(index !== -1){\r\n\t\t\t\t\t\tthis.campaignList.splice(index, 1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t)\t\r\n\t\t});\r\n\t}\r\n\r\n}\r\n"],"sourceRoot":"webpack:///"}